# -*- coding: utf-8 -*-

from .twitter_api import TwitterAPI
from .twitter_auth import TwitterOAuth2
from .twitter_error import *
from .utils import generate_url
from .variables import ENDPOINT_AUTH, ENDPOINT_SEARCH

import pytest
import requests

def test_search_tweets(requests_mock):
    requests_mock.post(generate_url(ENDPOINT_AUTH), json={'token_type': 'bearer', 'access_token': 'ACCESSTOKENAAAAAAAAAALYX8wAAAAAAsgM6MD8%2F%2BqU75lSu8vhowzkfuZQ%3Db2MlUpIakaSUtLi0JsSSCsg53v5BTBPu9e3t4Bcgt7i5rzn6e9'})
    requests_mock.get(generate_url(ENDPOINT_SEARCH), json={'statuses': [{'created_at': 'Tue Oct 30 14:02:19 +0000 2018', 'id': 1057271484823961600, 'id_str': '1057271484823961600', 'text': "Can't wait to see #Harrier in full Black colour @BosePratap", 'truncated': False, 'entities': {'hashtags': [{'text': 'Harrier', 'indices': [18, 26]}], 'symbols': [], 'user_mentions': [{'screen_name': 'BosePratap', 'name': 'Pratap Bose', 'id': 468207519, 'id_str': '468207519', 'indices': [48, 59]}], 'urls': []}, 'metadata': {'iso_language_code': 'en', 'result_type': 'recent'}, 'source': '<a href="http://twitter.com/download/android" rel="nofollow">Twitter for Android</a>', 'in_reply_to_status_id': None, 'in_reply_to_status_id_str': None, 'in_reply_to_user_id': None, 'in_reply_to_user_id_str': None, 'in_reply_to_screen_name': None, 'user': {'id': 211234109, 'id_str': '211234109', 'name': 'Sudharson', 'screen_name': 'sudharson007', 'location': 'chennai', 'description': 'Tweets are personal and random, PROUD INDIAN,6.1ft, Introvert,Messi ,Nadal,Thala, Modi, Mani Rathnam,ARR, Politics,Books,movie buff, PS4,nature lover,Cars,bikes', 'url': None, 'entities': {'description': {'urls': []}}, 'protected': False, 'followers_count': 1566, 'friends_count': 1172, 'listed_count': 13, 'created_at': 'Tue Nov 02 18:02:38 +0000 2010', 'favourites_count': 11969, 'utc_offset': None, 'time_zone': None, 'geo_enabled': True, 'verified': False, 'statuses_count': 21193, 'lang': 'en', 'contributors_enabled': False, 'is_translator': False, 'is_translation_enabled': False, 'profile_background_color': 'EBEBEB', 'profile_background_image_url': 'http://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_image_url_https': 'https://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_tile': True, 'profile_image_url': 'http://pbs.twimg.com/profile_images/1034031995976744960/uh7BPSUA_normal.jpg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/1034031995976744960/uh7BPSUA_normal.jpg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/211234109/1539234950', 'profile_link_color': '990000', 'profile_sidebar_border_color': 'FFFFFF', 'profile_sidebar_fill_color': 'F3F3F3', 'profile_text_color': '333333', 'profile_use_background_image': True, 'has_extended_profile': True, 'default_profile': False, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None, 'translator_type': 'none'}, 'geo': None, 'coordinates': None, 'place': None, 'contributors': None, 'is_quote_status': False, 'retweet_count': 0, 'favorite_count': 0, 'favorited': False, 'retweeted': False, 'lang': 'en'}], 'search_metadata': {'completed_in': 0.035, 'max_id': 1057271484823961600, 'max_id_str': '1057271484823961600', 'next_results': '?max_id=1057271484823961599&q=%23Harrier&count=1&include_entities=1', 'query': '%23Harrier', 'refresh_url': '?since_id=1057271484823961600&q=%23Harrier&include_entities=1', 'count': 1, 'since_id': 0, 'since_id_str': '0'}})
    consumer_key = 'key'
    consumer_secret = 'secret'
    client = TwitterAPI(TwitterOAuth2(consumer_key, consumer_secret))
    result = client.search_tweets('#Harrier', {'count':1})
    assert result  == {'statuses': [{'created_at': 'Tue Oct 30 14:02:19 +0000 2018', 'id': 1057271484823961600, 'id_str': '1057271484823961600', 'text': "Can't wait to see #Harrier in full Black colour @BosePratap", 'truncated': False, 'entities': {'hashtags': [{'text': 'Harrier', 'indices': [18, 26]}], 'symbols': [], 'user_mentions': [{'screen_name': 'BosePratap', 'name': 'Pratap Bose', 'id': 468207519, 'id_str': '468207519', 'indices': [48, 59]}], 'urls': []}, 'metadata': {'iso_language_code': 'en', 'result_type': 'recent'}, 'source': '<a href="http://twitter.com/download/android" rel="nofollow">Twitter for Android</a>', 'in_reply_to_status_id': None, 'in_reply_to_status_id_str': None, 'in_reply_to_user_id': None, 'in_reply_to_user_id_str': None, 'in_reply_to_screen_name': None, 'user': {'id': 211234109, 'id_str': '211234109', 'name': 'Sudharson', 'screen_name': 'sudharson007', 'location': 'chennai', 'description': 'Tweets are personal and random, PROUD INDIAN,6.1ft, Introvert,Messi ,Nadal,Thala, Modi, Mani Rathnam,ARR, Politics,Books,movie buff, PS4,nature lover,Cars,bikes', 'url': None, 'entities': {'description': {'urls': []}}, 'protected': False, 'followers_count': 1566, 'friends_count': 1172, 'listed_count': 13, 'created_at': 'Tue Nov 02 18:02:38 +0000 2010', 'favourites_count': 11969, 'utc_offset': None, 'time_zone': None, 'geo_enabled': True, 'verified': False, 'statuses_count': 21193, 'lang': 'en', 'contributors_enabled': False, 'is_translator': False, 'is_translation_enabled': False, 'profile_background_color': 'EBEBEB', 'profile_background_image_url': 'http://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_image_url_https': 'https://abs.twimg.com/images/themes/theme7/bg.gif', 'profile_background_tile': True, 'profile_image_url': 'http://pbs.twimg.com/profile_images/1034031995976744960/uh7BPSUA_normal.jpg', 'profile_image_url_https': 'https://pbs.twimg.com/profile_images/1034031995976744960/uh7BPSUA_normal.jpg', 'profile_banner_url': 'https://pbs.twimg.com/profile_banners/211234109/1539234950', 'profile_link_color': '990000', 'profile_sidebar_border_color': 'FFFFFF', 'profile_sidebar_fill_color': 'F3F3F3', 'profile_text_color': '333333', 'profile_use_background_image': True, 'has_extended_profile': True, 'default_profile': False, 'default_profile_image': False, 'following': None, 'follow_request_sent': None, 'notifications': None, 'translator_type': 'none'}, 'geo': None, 'coordinates': None, 'place': None, 'contributors': None, 'is_quote_status': False, 'retweet_count': 0, 'favorite_count': 0, 'favorited': False, 'retweeted': False, 'lang': 'en'}], 'search_metadata': {'completed_in': 0.035, 'max_id': 1057271484823961600, 'max_id_str': '1057271484823961600', 'next_results': '?max_id=1057271484823961599&q=%23Harrier&count=1&include_entities=1', 'query': '%23Harrier', 'refresh_url': '?since_id=1057271484823961600&q=%23Harrier&include_entities=1', 'count': 1, 'since_id': 0, 'since_id_str': '0'}}
